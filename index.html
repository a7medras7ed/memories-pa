<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>تطبيق الذكريات</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    body {
      font-family: 'Arial', sans-serif;
      direction: rtl;
      background: linear-gradient(to bottom right, #e0eafc, #cfdef3);
      margin: 0;
      padding: 0;
    }

    .container {
      max-width: 800px;
      margin: auto;
      padding: 20px;
    }

    h2 {
      text-align: center;
    }

    .user-info {
      text-align: center;
      margin-bottom: 20px;
    }

    .user-info img {
      width: 60px;
      height: 60px;
      border-radius: 50%;
    }

    .memory-form {
      background: white;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      display: none;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .memory-form.show {
      display: block;
    }

    .memory-card {
      background: white;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .memory-card img, .memory-card video {
      max-width: 100%;
      border-radius: 10px;
      margin-bottom: 10px;
    }

    input, textarea, select {
      width: 100%;
      margin-bottom: 10px;
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    button {
      padding: 10px 20px;
      border: none;
      background: #007BFF;
      color: white;
      border-radius: 5px;
      cursor: pointer;
    }

    button:hover {
      background: #0056b3;
    }

    .reaction-bar {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .reaction-bar span {
      cursor: pointer;
      font-size: 20px;
    }

    .comment-box {
      margin-top: 10px;
      display: none;
    }

    .comment-box.show {
      display: block;
    }

    .comment {
      background: #eee;
      padding: 8px;
      border-radius: 5px;
      margin-bottom: 5px;
    }

    #addMemoryBtn {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background-color: #007BFF;
      color: white;
      border: none;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      font-size: 24px;
      cursor: pointer;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      z-index: 1000;
    }

    #userForm {
      background: white;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>🕰️ تطبيق الذكريات</h2>

    <!-- نموذج تسجيل المستخدم -->
    <div id="userForm">
      <input type="text" id="username" placeholder="ادخل اسمك">
      <input type="file" id="userImage" accept="image/*">
      <button onclick="registerUser()">دخول</button>
    </div>

    <!-- عرض معلومات المستخدم -->
    <div class="user-info" id="userInfo" style="display:none;">
      <img id="profilePic" src="">
      <h3 id="displayName"></h3>
    </div>

    <!-- نموذج إضافة الذكرى -->
    <div class="memory-form" id="memoryForm">
      <textarea id="memoryText" placeholder="اكتب الذكرى..."></textarea>
      <input type="file" id="memoryMedia" accept="image/*,video/*">
      <select id="mood">
        <option value="">اختر حالتك</option>
        <option value="😄 يشعر بالسعادة">😄 يشعر بالسعادة</option>
        <option value="🥰 يشعر بالحب">🥰 يشعر بالحب</option>
        <option value="😢 يشعر بالحزن">😢 يشعر بالحزن</option>
        <option value="😡 يشعر بالغضب">😡 يشعر بالغضب</option>
      </select>
      <button onclick="addMemory()">نشر</button>
    </div>

    <!-- الذكريات -->
    <div id="memoriesContainer"></div>
  </div>

  <button id="addMemoryBtn" onclick="toggleMemoryForm()">+</button>

  <script>
    const userForm = document.getElementById('userForm');
    const memoryForm = document.getElementById('memoryForm');
    const userInfo = document.getElementById('userInfo');

    function registerUser() {
      const name = document.getElementById('username').value;
      const file = document.getElementById('userImage').files[0];

      if (name && file) {
        const reader = new FileReader();
        reader.onload = function(event) {
          const image = event.target.result;
          localStorage.setItem('username', name);
          localStorage.setItem('userpic', image);
          showUserInfo();
        }
        reader.readAsDataURL(file);
      } else {
        alert("يرجى إدخال اسمك وتحميل صورة");
      }
    }

    function showUserInfo() {
      const name = localStorage.getItem('username');
      const pic = localStorage.getItem('userpic');

      if (name && pic) {
        document.getElementById('displayName').innerText = name;
        document.getElementById('profilePic').src = pic;
        userForm.style.display = 'none';
        userInfo.style.display = 'block';
      }
    }

    function toggleMemoryForm() {
      memoryForm.classList.toggle('show');
    }

    function addMemory() {
      const text = document.getElementById('memoryText').value;
      const mood = document.getElementById('mood').value;
      const fileInput = document.getElementById('memoryMedia');
      const file = fileInput.files[0];

      const name = localStorage.getItem('username');
      const pic = localStorage.getItem('userpic');

      const card = document.createElement('div');
      card.className = 'memory-card';

      let mediaHTML = '';
      if (file) {
        const reader = new FileReader();
        reader.onload = function(event) {
          const mediaURL = event.target.result;
          mediaHTML = file.type.startsWith('video')
            ? `<video src="${mediaURL}" controls></video>`
            : `<img src="${mediaURL}">`;

          appendCard();
        }
        reader.readAsDataURL(file);
      } else {
        appendCard();
      }

      function appendCard() {
        card.innerHTML = `
          <div style="display:flex; align-items:center; gap:10px;">
            <img src="${pic}" width="40" height="40" style="border-radius:50%;">
            <strong>${name}</strong>
          </div>
          <p>${mood ? mood + ' - ' : ''}${text}</p>
          ${mediaHTML}
          <div class="reaction-bar">
            <span onclick="setReaction(this)">❤️</span>
            <span onclick="setReaction(this)">😂</span>
            <span onclick="setReaction(this)">😢</span>
            <span onclick="setReaction(this)">😡</span>
            <span onclick="toggleComment(this)">💬</span>
            <span>🔁</span>
          </div>
          <div class="comment-box">
            <input type="text" class="comment-input" placeholder="اكتب تعليقًا...">
            <button onclick="postComment(this)">نشر</button>
            <div class="comments-list"></div>
          </div>
        `;
        document.getElementById('memoriesContainer').prepend(card);
        document.getElementById('memoryText').value = '';
        document.getElementById('mood').value = '';
        fileInput.value = '';
        memoryForm.classList.remove('show');
      }
    }

    function setReaction(el) {
      el.parentNode.querySelectorAll('span').forEach(span => span.style.opacity = '0.3');
      el.style.opacity = '1';
    }

    function toggleComment(el) {
      const box = el.parentNode.nextElementSibling;
      box.classList.toggle('show');
    }

    function postComment(btn) {
      const input = btn.parentNode.querySelector('.comment-input');
      const text = input.value.trim();
      if (text) {
        const comment = document.createElement('div');
        comment.className = 'comment';
        comment.innerText = text;
        btn.parentNode.querySelector('.comments-list').appendChild(comment);
        input.value = '';
      }
    }

    // إظهار بيانات المستخدم عند تحميل الصفحة
    window.onload = showUserInfo;
  </script>
</body>
</html>
