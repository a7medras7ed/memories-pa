<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>تطبيق الذكريات</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to bottom, #e3f2fd, #ffffff);
      direction: rtl;
    }
    .header {
      background-color: #2196f3;
      color: white;
      padding: 15px;
      text-align: center;
      font-size: 22px;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .toolbar {
      display: flex;
      justify-content: space-around;
      padding: 10px;
      background: #fff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .toolbar i {
      font-size: 20px;
      cursor: pointer;
      color: #555;
    }
    .search-box {
      display: none;
      text-align: center;
      margin: 10px;
    }
    .search-box input {
      padding: 8px;
      width: 80%;
      border: 1px solid #ccc;
      border-radius: 25px;
      text-align: right;
    }
    .container {
      padding: 15px;
      max-width: 600px;
      margin: auto;
    }
    .memory-form, .register-form {
      background: white;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 10px;
      display: none;
    }
    .memory-form.show, .register-form.show {
      display: block;
    }
    textarea, input, select {
      width: 100%;
      margin: 5px 0;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .memory {
      background: white;
      padding: 10px;
      margin-bottom: 15px;
      border-radius: 10px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .memory img, .memory video {
      max-width: 100%;
      border-radius: 10px;
      margin: 5px 0;
    }
    .actions {
      display: flex;
      justify-content: space-around;
      margin-top: 10px;
    }
    .reactions {
      display: none;
      position: absolute;
      background: white;
      border-radius: 25px;
      padding: 5px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      margin-top: -50px;
    }
    .reactions span {
      cursor: pointer;
      font-size: 18px;
      padding: 0 5px;
    }
    .comment-box {
      display: none;
      margin-top: 10px;
    }
    .comment-box input {
      border-radius: 25px;
    }
    .user-bar {
      text-align: center;
      margin: 15px 0;
    }
    .user-bar img {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: block;
      margin: auto;
    }
    .add-memory-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #2196f3;
      color: white;
      border: none;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      font-size: 28px;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
  </style>
</head>
<body>

  <div class="header">📸 تطبيق الذكريات</div>

  <div class="toolbar">
    <i class="fas fa-search" onclick="toggleSearch()"></i>
    <i class="fas fa-video" title="لايف"></i>
    <i class="fas fa-comments" title="دردشة"></i>
  </div>

  <div class="search-box" id="searchBox">
    <input type="text" placeholder="ابحث عن مستخدم...">
  </div>

  <div class="container">
    <div class="user-bar" id="userBar"></div>

    <div class="register-form" id="registerForm">
      <h3>تسجيل المستخدم</h3>
      <input type="text" id="username" placeholder="اسم المستخدم" required />
      <input type="file" id="userPhoto" accept="image/*" />
      <button onclick="registerUser()">حفظ</button>
    </div>

    <div class="memory-form" id="memoryForm">
      <h3>إضافة ذكرى جديدة</h3>
      <textarea id="memoryText" placeholder="ما الذي تفكر فيه؟"></textarea>
      <input type="file" id="memoryMedia" accept="image/*,video/*">
      <select id="mood">
        <option value="">-- الحالة الشعورية --</option>
        <option>😊 سعيد</option>
        <option>😢 حزين</option>
        <option>😎 فرحان</option>
        <option>😡 غاضب</option>
      </select>
      <button onclick="submitMemory()">نشر</button>
    </div>

    <div id="memoriesContainer"></div>
  </div>

  <button class="add-memory-btn" onclick="toggleMemoryForm()">＋</button>

  <script>
    const searchBox = document.getElementById("searchBox");
    function toggleSearch() {
      searchBox.style.display = searchBox.style.display === "block" ? "none" : "block";
    }

    // ========== التسجيل ==========
    const userBar = document.getElementById("userBar");
    const registerForm = document.getElementById("registerForm");
    let currentUser = JSON.parse(localStorage.getItem("memoryUser"));

    if (!currentUser) {
      registerForm.classList.add("show");
    } else {
      displayUserBar();
    }

    function registerUser() {
      const name = document.getElementById("username").value;
      const photoFile = document.getElementById("userPhoto").files[0];
      if (!name || !photoFile) return alert("أدخل الاسم والصورة");
      const reader = new FileReader();
      reader.onload = function (e) {
        const id = Math.floor(1000000 + Math.random() * 9000000);
        currentUser = { name, photo: e.target.result, id };
        localStorage.setItem("memoryUser", JSON.stringify(currentUser));
        registerForm.classList.remove("show");
        displayUserBar();
      };
      reader.readAsDataURL(photoFile);
    }

    function displayUserBar() {
      userBar.innerHTML = `
        <img src="${currentUser.photo}" />
        <p>${currentUser.name} - ID: ${currentUser.id}</p>
      `;
    }

    // ========== إضافة ذكرى ==========
    const memoryForm = document.getElementById("memoryForm");
    function toggleMemoryForm() {
      memoryForm.classList.toggle("show");
    }

    function submitMemory() {
      const text = document.getElementById("memoryText").value;
      const mood = document.getElementById("mood").value;
      const file = document.getElementById("memoryMedia").files[0];
      const reader = new FileReader();
      reader.onload = function (e) {
        const src = file ? e.target.result : "";
        const type = file ? (file.type.startsWith("video") ? "video" : "image") : "";
        addMemory(text, src, type, mood);
        document.getElementById("memoryText").value = "";
        document.getElementById("memoryMedia").value = "";
        document.getElementById("mood").value = "";
        memoryForm.classList.remove("show");
      };
      if (file) {
        reader.readAsDataURL(file);
      } else {
        addMemory(text, "", "", mood);
        memoryForm.classList.remove("show");
      }
    }

    function addMemory(text, media, type, mood) {
      const div = document.createElement("div");
      div.className = "memory";
      div.innerHTML = `
        <strong>${currentUser.name} (${currentUser.id})</strong>
        ${mood ? `<p>${mood}</p>` : ""}
        ${text ? `<p>${text}</p>` : ""}
        ${type === "image" ? `<img src="${media}" />` : ""}
        ${type === "video" ? `<video src="${media}" controls></video>` : ""}
        <div class="actions">
          <div style="position:relative">
            <i class="fa-regular fa-thumbs-up" onclick="showReactions(this)"></i>
            <div class="reactions">
              <span onclick="setReaction(this,'👍')">👍</span>
              <span onclick="setReaction(this,'❤️')">❤️</span>
              <span onclick="setReaction(this,'😂')">😂</span>
              <span onclick="setReaction(this,'😢')">😢</span>
            </div>
          </div>
          <i class="fa-regular fa-comment" onclick="toggleCommentBox(this)"></i>
          <i class="fa-solid fa-share"></i>
        </div>
        <div class="comment-box">
          <input type="text" placeholder="اكتب تعليقًا...">
        </div>
      `;
      document.getElementById("memoriesContainer").prepend(div);
    }

    function showReactions(el) {
      const box = el.parentElement.querySelector(".reactions");
      box.style.display = "block";
      setTimeout(() => (box.style.display = "none"), 3000);
    }

    function setReaction(el, emoji) {
      const container = el.closest(".reactions").parentElement;
      container.innerHTML = `<span>${emoji}</span>`;
    }

    function toggleCommentBox(el) {
      const box = el.closest(".memory").querySelector(".comment-box");
      box.style.display = box.style.display === "block" ? "none" : "block";
    }
  </script>
</body>
</html>
